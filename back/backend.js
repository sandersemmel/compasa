import express from 'express';
import * as controller from './controller.js';
import path from 'path';
import lnservice from 'ln-service';
//import {authenticatedLndGrpc, getHeight} from 'lightning';

const tls = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLRENDQWMyZ0F3SUJBZ0lSQU5kWjBsMjZheUZLUk4zTlpHYkp5U3d3Q2dZSUtvWkl6ajBFQXdJd01URWYKTUIwR0ExVUVDaE1XYkc1a0lHRjFkRzluWlc1bGNtRjBaV1FnWTJWeWRERU9NQXdHQTFVRUF4TUZZV3hwWTJVdwpIaGNOTWpJd05ERTBNakF6T0RNM1doY05Nak13TmpBNU1qQXpPRE0zV2pBeE1SOHdIUVlEVlFRS0V4WnNibVFnCllYVjBiMmRsYm1WeVlYUmxaQ0JqWlhKME1RNHdEQVlEVlFRREV3VmhiR2xqWlRCWk1CTUdCeXFHU000OUFnRUcKQ0NxR1NNNDlBd0VIQTBJQUJHQUttTFg3bVV3ZTQ2b2k1SG9KMThaMGpzVUZLRDRSeWZxQTc3ZW5wMjdVdlVDTQp0SXR6cXk0S3NHS2ZhUmxHWVRIV0MzTVRYUTIxeEhKZDcyT25hL2FqZ2NVd2djSXdEZ1lEVlIwUEFRSC9CQVFECkFnS2tNQk1HQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01CTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3SFFZRFZSME8KQkJZRUZENU5GT0N2KzNGSW9xMHpJMlB5cUM0TmJ0YzlNR3NHQTFVZEVRUmtNR0tDQldGc2FXTmxnZ2xzYjJOaApiR2h2YzNTQ0JXRnNhV05sZ2c1d2IyeGhjaTF1TVMxaGJHbGpaWUlFZFc1cGVJSUtkVzVwZUhCaFkydGxkSUlIClluVm1ZMjl1Ym9jRWZ3QUFBWWNRQUFBQUFBQUFBQUFBQUFBQUFBQUFBWWNFckJJQUJEQUtCZ2dxaGtqT1BRUUQKQWdOSkFEQkdBaUVBd201U1VkaURUTVVUQkUydmdMRUJ6Q2VpSmtmWERUL0liRHZxZ0lOWUxoQUNJUUR5R2JUSApFSG90Ums2NWFVMFhqam9oWkN6Nmg5cVpiWGFrV0FFeXhiM1BJQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"; ///Users/sander/.polar/networks/1/volumes/lnd/alice/tls.cert
const invoiceMacaroon = "AgEDbG5kAlgDChBRB3B1vKczZnLAeanR3Pv6EgEwGhYKB2FkZHJlc3MSBHJlYWQSBXdyaXRlGhcKCGludm9pY2VzEgRyZWFkEgV3cml0ZRoPCgdvbmNoYWluEgRyZWFkAAAGIM/qikSZVR6atnkswZUFceaqJHni3Q96WLJpJ+TTaqSL"; ///Users/sander/.polar/networks/1/volumes/lnd/alice/data/chain/bitcoin/regtest/invoice.macaroon
const adminMacaroon = "AgEDbG5kAvgBAwoQUwdwdbynM2ZywHmp0dz7+hIBMBoWCgdhZGRyZXNzEgRyZWFkEgV3cml0ZRoTCgRpbmZvEgRyZWFkEgV3cml0ZRoXCghpbnZvaWNlcxIEcmVhZBIFd3JpdGUaIQoIbWFjYXJvb24SCGdlbmVyYXRlEgRyZWFkEgV3cml0ZRoWCgdtZXNzYWdlEgRyZWFkEgV3cml0ZRoXCghvZmZjaGFpbhIEcmVhZBIFd3JpdGUaFgoHb25jaGFpbhIEcmVhZBIFd3JpdGUaFAoFcGVlcnMSBHJlYWQSBXdyaXRlGhgKBnNpZ25lchIIZ2VuZXJhdGUSBHJlYWQAAAYg7PSD0gNjxKYWB58QNXpg9pt0wORuHbXzsl1dLja/KpU=";
const socket = "localhost:10001";

const base64copytls = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLRENDQWMyZ0F3SUJBZ0lSQU5kWjBsMjZheUZLUk4zTlpHYkp5U3d3Q2dZSUtvWkl6ajBFQXdJd01URWYKTUIwR0ExVUVDaE1XYkc1a0lHRjFkRzluWlc1bGNtRjBaV1FnWTJWeWRERU9NQXdHQTFVRUF4TUZZV3hwWTJVdwpIaGNOTWpJd05ERTBNakF6T0RNM1doY05Nak13TmpBNU1qQXpPRE0zV2pBeE1SOHdIUVlEVlFRS0V4WnNibVFnCllYVjBiMmRsYm1WeVlYUmxaQ0JqWlhKME1RNHdEQVlEVlFRREV3VmhiR2xqWlRCWk1CTUdCeXFHU000OUFnRUcKQ0NxR1NNNDlBd0VIQTBJQUJHQUttTFg3bVV3ZTQ2b2k1SG9KMThaMGpzVUZLRDRSeWZxQTc3ZW5wMjdVdlVDTQp0SXR6cXk0S3NHS2ZhUmxHWVRIV0MzTVRYUTIxeEhKZDcyT25hL2FqZ2NVd2djSXdEZ1lEVlIwUEFRSC9CQVFECkFnS2tNQk1HQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01CTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3SFFZRFZSME8KQkJZRUZENU5GT0N2KzNGSW9xMHpJMlB5cUM0TmJ0YzlNR3NHQTFVZEVRUmtNR0tDQldGc2FXTmxnZ2xzYjJOaApiR2h2YzNTQ0JXRnNhV05sZ2c1d2IyeGhjaTF1TVMxaGJHbGpaWUlFZFc1cGVJSUtkVzVwZUhCaFkydGxkSUlIClluVm1ZMjl1Ym9jRWZ3QUFBWWNRQUFBQUFBQUFBQUFBQUFBQUFBQUFBWWNFckJJQUJEQUtCZ2dxaGtqT1BRUUQKQWdOSkFEQkdBaUVBd201U1VkaURUTVVUQkUydmdMRUJ6Q2VpSmtmWERUL0liRHZxZ0lOWUxoQUNJUUR5R2JUSApFSG90Ums2NWFVMFhqam9oWkN6Nmg5cVpiWGFrV0FFeXhiM1BJQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K";
const base64copyadminmacaroon = "AgEDbG5kAvgBAwoQUwdwdbynM2ZywHmp0dz7+hIBMBoWCgdhZGRyZXNzEgRyZWFkEgV3cml0ZRoTCgRpbmZvEgRyZWFkEgV3cml0ZRoXCghpbnZvaWNlcxIEcmVhZBIFd3JpdGUaIQoIbWFjYXJvb24SCGdlbmVyYXRlEgRyZWFkEgV3cml0ZRoWCgdtZXNzYWdlEgRyZWFkEgV3cml0ZRoXCghvZmZjaGFpbhIEcmVhZBIFd3JpdGUaFgoHb25jaGFpbhIEcmVhZBIFd3JpdGUaFAoFcGVlcnMSBHJlYWQSBXdyaXRlGhgKBnNpZ25lchIIZ2VuZXJhdGUSBHJlYWQAAAYg7PSD0gNjxKYWB58QNXpg9pt0wORuHbXzsl1dLja/KpU=";

const tlshex = "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949434b444343416332674177494241674952414e645a306c32366179464b524e334e5a47624a79537777436759494b6f5a497a6a3045417749774d5445660a4d4230474131554543684d576247356b494746316447396e5a57356c636d46305a575167593256796444454f4d4177474131554541784d4659577870593255770a4868634e4d6a49774e4445304d6a417a4f444d335768634e4d6a4d774e6a41354d6a417a4f444d33576a41784d523877485159445651514b45785a73626d51670a595856306232646c626d56795958526c5a43426a5a584a304d51347744415944565151444577566862476c6a5a54425a4d424d4742797147534d3439416745470a43437147534d343941774548413049414247414b6d4c58376d55776534366f6935486f4a31385a306a7355464b443452796671413737656e703237557655434d0a7449747a7179344b73474b6661526c475954485743334d545851323178484a6437324f6e612f616a676355776763497744675944565230504151482f424151440a41674b6b4d424d47413155644a51514d4d416f47434373474151554642774d424d41384741315564457745422f7751464d414d4241663877485159445652304f0a424259454644354e464f43762b3346496f71307a493250797143344e627463394d477347413155644551526b4d474b434257467361574e6c67676c7362324e680a62476876633353434257467361574e6c6767357762327868636931754d53316862476c6a5a594945645735706549494b64573570654842685932746c644949480a596e566d59323975626f63456677414141596351414141414141414141414141414141414141414141596345724249414244414b42676771686b6a4f505151440a41674e4a4144424741694541776d355355646944544d555442453276674c45427a4365694a6b665844542f496244767167494e594c68414349514479476254480a45486f74526b3635615530586a6a6f685a437a366839715a6258616b574145797862335049413d3d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a";
const adminhex = "0201036c6e6402f801030a1053077075bca7336672c079a9d1dcfbfa1201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e657261746512047265616400000620ecf483d20363c4a616079f10357a60f69b74c0e46e1db5f3b25d5d2e36bf2a95";
let {lnd} = lnservice.authenticatedLndGrpc({
    cert: tls,
    macaroon: adminMacaroon,
    socket: socket
})

let lndz = lnservice.authenticatedLndGrpc({
    cert: tls,
    macaroon: adminMacaroon,
    socket: socket
})





const app = express();

app.use(express.static('front'))


app.get('/', function(req,res){


})

app.get('/lntest', async function(req,res){
    //let wallInfo = await lnservice.getHeight(lndz);

    try {
        console.log("lnd:",lnd);
        console.log("lndz", lndz);

        let res = await lnservice.createInvoice({mtokens: "500", description: "best invoice", lnd:lnd})

        console.log("createinvoice res:",res);
    } catch (error) {
        console.log("ERROR MANE",error);
    }   

    res.send("lntest");

})

app.get('/getinvoices', async function(req,res){
    try {
        let invoices = await lnservice.getInvoices({lnd});
        console.log("invoices:", invoices);
    } catch (error) {
        console.log(error)
    }

    res.send("invoices");
})

app.get('/app', function(req,res){
    res.sendFile(path.resolve()+'/front/index.html')
})


console.log("Started")




app.get('/test', async function(req,res){
    console.log("hello")
    //controller.createuser();
    try {
        let result = await controller.test();
        console.log("query result should be true but is: ",result);
        res.send("koira")
    } catch (error) {
        console.log(error);
    }

})


app.get('/getToken', async function(req,res){
    //await 
})



app.listen(3000);